{% load static %}
{% load debug_tags %}
<!DOCTYPE html>
<html>
<head>
	<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

	{% if not page_info and settings.DEBUG %}
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			setTimeout(function() { alert(
				'Ошибка! page_info отсутствует в контексте! ' +
				'Бекендеры, проверьте что используете правильный View, ' +
				'добавляющий page_info в контекст!'
			)}, 200);
		});
	</script>
	{% endif %}

	{% block html_title_override %}
		<!-- page_info будет всегда, но если был использован неправильный view, пускай будет хоть какой-то -->
		<title>{{ page_info.get_html_title|default:global.site_settings.site_name }}</title>
	{% endblock %}

	<meta name="description" content="{{page_info.get_html_description}}">
	<meta name="og:type" content="{{page_info.og_type}}">
	{% block custom_og_tags %}{% endblock %}
	<meta name="og:title" content="{{page_info.og_title}}">
	{% if page_info.og_description %}
		<meta name="og:description" content="{{page_info.og_description}}">{% endif %}
	{% if page_info.og_image_url or global.site_settings.favicon %}
		<meta name="og:image" content="{{page_info.og_image_url|default:global.site_settings.favicon.url}}">
	{% endif %}
	<meta name="og:site_name" content="{{site_settings.site_name}}">
	<meta name="og:url" content="{{page_info.get_absolute_url}}">
	<link rel="cannonical" href="{{page_info.get_absolute_url}}">

	<meta charset="utf-8">
	{% with microdata=page_info.get_microdata_dumped %}
		{% if microdata %}
			<script type="application/ld+json">{{microdata}}</script>
	{% endif %}{% endwith %}

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
	<script>{{ global.site_settings.head_script|safe }}</script>
</head>
<style>
	/* * { margin: 0; } */
	:root {
		font-family: consolas;
		background-color: #050505;
		--primary-text-color: white;
		--secondary-text-color: gray;
		--secondary-text-color-hover: rgba(128, 128, 128, 0.8);
		color: var(--primary-text-color);
		--lighting-1: #FFFFFF08;
		--lighting-2: #FFFFFF10;
		--lighting-3: #FFFFFF18;
		--lighting-4: #FFFFFF20;
		--lighting-5: #FFFFFF28;
	}
	a {color: lightskyblue;}
	a:hover { color: lightblue;}
	a:visited { color: lightskyblue;}

	.main-title {
		margin: 0;
		font-size: 2rem;
		font-weight: 600;
	}
	.breadcrumbs {
		font-family: 'Roboto Mono', 'JetBrains Mono', 'Cascadia Code';
		color: var(--secondary-text-color);

		a {
			color: var(--secondary-text-color);
			transition: 0.2s;
		}
		a:hover {
			color: var(--secondary-text-color-hover);
			transition: 0.2s;
		}
	}

	body {
		display: flex;
		width: 100vw;
		height: 100vh;
		overflow: hidden;
		margin: 0;
	}

	header {
		/* Хедер растягивается на всю ширину */
		flex: 0 0 auto; /* Но не растягивается, не сжимается, авто высота */
		padding: 0.5rem;
		border-bottom: 1px solid var(--lighting-2);
		min-height: 0; /* Ключевое свойство для работы скролла в flex-контейнере */
	}

	.content-container {
		display: flex;
		flex-direction: column;
		flex: 1; /* Занимает все оставшееся пространство */
		min-height: 0; /* Ключевое свойство для работы скролла в flex-контейнере */
	}

	.burger {
		background-color: var(--lighting-1);
		border-right: 1px solid var(--lighting-1);
		width: 16rem;
		padding: 1rem;
		overflow-y: auto; /* На случай, если меню тоже будет длинным */
		display: flex;
		flex-direction: column;
		justify-content: stretch;
	}

	.pages-list {
		display: flex;
		flex: 1;
		flex-direction: column;
		overflow-y: auto;
		gap: 0.5rem;

		.body {
			flex: 1;
			display: flex;
			flex-direction: column;
			gap: 0.5rem;

			.button.current {background-color: var(--lighting-3);}
			.button.current:hover {background-color: var(--lighting-4);}
			.button.current:active {background-color: var(--lighting-5);}
		}
	}

	main {
		flex: 1; /* Занимает всё доступное пространство */
		padding: 1rem;
		overflow-y: auto; /* auto вместо scroll - скролл появится только когда нужно */
		min-height: 0; /* Также важно для flex-элементов */
	}

	::-webkit-scrollbar {width: 0.35rem;}
	::-webkit-scrollbar-track {background-color: var(--lighting-2);}
	::-webkit-scrollbar-thumb {background-color: var(--lighting-2);}
	::-webkit-scrollbar-thumb:hover {background-color: var(--lighting-3);}
	::-webkit-scrollbar-thumb:active {background-color: var(--lighting-4);}

	button, .a-inherit {
		font-family: inherit;
		font-weight: inherit;
		font-size: inherit;
		color: inherit;
		width: inherit;
		text-decoration: none;
	}
	button, .button {
		background-color: var(--lighting-1);
		border: 1px solid var(--lighting-1);
		padding: 0.5rem;
		user-select: none;
		text-align: center;
		cursor: pointer;
		/* for a */
		color: var(--primary-text-color);
		text-decoration: none;
	}
	/* for a */
	.button:hover, .button:active, .button:visited {
		color: var(--primary-text-color);
	}
	button:hover, .button:hover {background-color: var(--lighting-2);}
	button:active, .button:active {background-color: var(--lighting-3);}
	.switch {
		position: relative;
		display: inherit;
		input {display: none;}
		.button {flex: 1;}
		input:checked + .button {background-color: var(--lighting-3);}
		input:checked + .button:hover {background-color: var(--lighting-4);}
	}
	
	.oneline-text {
		white-space: nowrap;
		text-overflow: ellipsis;
		overflow: hidden;
	}

	details summary {user-select: none;}
</style>
<body>
	<div class="burger">
		<h1 class="main-title" style="margin-bottom: 2rem;">
			Debug UI v0.1
		</h1>

		<div style="display: flex; flex-direction: column; gap: 0.5rem;">
			<div style="display: flex; flex-direction: column; gap: 0.5rem;">
				<a class="button" href="{{page_info.get_admin_url}}">Смотреть в админке</a>
				<label class="switch">
					<input type="checkbox">
					<span class="button">Смотреть контекст</span>
				</label>
			</div>
			<div style="display: flex; gap: 0.5rem;">
				<a class="button" style="flex: 1;" href="/sitemap.xml">Sitemap.xml</a>
				<a class="button" style="flex: 1;" href="/robots.txt">Robots.txt</a>
			</div>
		</div>

		<h2 style="margin-block: 1.5rem 0.5rem;">Страницы</h2>
		<div class="pages-list">
			<div class="body">
				{% for gpage in global.pages.values %}
				<!-- только для page -->
				{% with is_current=gpage.pk|is_equal:page.pk %}
					<a class="button {% if is_current %}current{% endif %} oneline-text"
						style="text-align: left;"
						title="{{ gpage.name }}"
						href="{{gpage.get_absolute_url}}">
						{% if is_current %}→{% endif %}
						{{ gpage.name }}
					</a>
				{% endwith %}
				{% endfor %}
			</div>
		</div>
	</div>
	<div class="content-container">
		<header class="breadcrumbs">
			<!-- Будет генерироваться -->
			<a class="a-inherit" href="/">Главная</a>/<a class="a-inherit" href="/">Каталог</a>/<a class="a-inherit" href="/">Коллекторные шкафы</a>/<a class="a-inherit" href="/">Настенные</a>/<a class="a-inherit" href="/">ВКБД - 20</a>
		</header>
		<main>
			{% block content %}
			<div style="text-align: center;">
				<div>Тут пусто. Ага.</div>
				<div style="color: gray; font-size: 0.75rem;">(наполнение content по умолчанию)</div>
			</div>
			<style>
				main {
					display: flex;
					justify-content: center;
					align-items: center;
				}
			</style>
			{% endblock %}
		</main>
	</div>
</body>
<!-- <div class="volume-controls">
  <label>Громкость hover
    <input
      type="range"
      min="0" max="1" step="0.1"
      value="{{ settings.DEBUG_TEMPLATES_HOVER_SOUND_VOLUME }}"
      class="volume-slider" data-sound="hover"
    >
  </label>

  <label>Громкость click
    <input
      type="range"
      min="0" max="1" step="0.1"
      value="{{ settings.DEBUG_TEMPLATES_CLICK_SOUND_VOLUME }}"
      class="volume-slider" data-sound="click"
    >
  </label>
  <label>Громкость switch
    <input
      type="range"
      min="0" max="1" step="0.1"
      value="{{ settings.DEBUG_TEMPLATES_CLICK_SOUND_VOLUME }}"
      class="volume-slider" data-sound="switch"
    >
  </label>
</div>
<style>
.volume-slider {
	vertical-align: middle;
}
</style> -->
{% if settings.DEBUG_TEMPLATES_SOUNDS_ENABLED %}
<script>
	// base64 format
	const getUrl = el => `https://github.com/space-wizards/space-station-14/raw/refs/heads/master/Resources/Audio/${el}.ogg`;
	const hoverSound = new Audio(getUrl("UserInterface/hover"));
	const clickSound = new Audio(getUrl("UserInterface/click"));
	const switchSound = new Audio(getUrl("Machines/button"));

	hoverSound.volume = parseFloat("{{ settings.DEBUG_TEMPLATES_HOVER_SOUND_VOLUME }}");
	clickSound.volume = parseFloat("{{ settings.DEBUG_TEMPLATES_CLICK_SOUND_VOLUME }}");
	switchSound.volume = 1;

	document.addEventListener('DOMContentLoaded', function() {
		document.querySelectorAll('.volume-slider').forEach(slider => {
			slider.addEventListener('input', (e) => {
				const volume = parseFloat(e.target.value);
				if (e.target.dataset.sound === 'hover') {
					hoverSound.volume = volume;
				} else if (e.target.dataset.sound === 'click') {
					clickSound.volume = volume;
				} else if (e.target.dataset.sound === 'switch') {
					clickSound.volume = volume;
				}
			});
		});
		isButton = event => event.target.closest('.button') || event.target.closest('button') || event.target.closest('.add-sounds');
		document.addEventListener('click', function(event) {
			if (event.target.closest('.switch')) {
				switchSound.currentTime = 0;
				switchSound.play();
			} else if (isButton(event)) {
				clickSound.play();
			}
		});
		document.addEventListener('mouseover', function(event) {
			if (isButton(event)) {
				hoverSound.currentTime = 0;
				hoverSound.play();
			}
		});
	});
</script>
{% endif %}
</html>
